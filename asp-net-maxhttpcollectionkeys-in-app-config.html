---
layout: layout
title: Contrib Youtube Orchard Field
---

<div class="post-wrapper">

<h1>Using MaxHttpCollectionKeys to fix error &#39;Operation is not valid due to the current state of the object&#39; during postback</h1>
 
<p>I came across this error recently, on a website which I had built for one of our clients.</p>
<pre>`Operation is not valid due to the current state of the object`.</pre>
<p>This occurs on Postback of the page.</p>
<p>After a quick search, I found the answer on <a href="http://stackoverflow.com/questions/8832470/operation-is-not-valid-due-to-the-current-state-of-the-object-error-during-pos" title="Stackoverflow answer" target="_blank">Stackoverflow</a></p>
<p>A security update for Microsoft .Net Framework meant that the number of fields which, by default, were allowed to be posted to a page was set to 1000, however the website in question was posting more. A quick fix for this is to add a setting into your web.config file;</p>
<pre class="default prettyprint" style="margin-top: 0px; margin-right: 0px; margin-bottom: 10px; margin-left: 0px; border-style: initial; border-color: initial; font-size: 14px; vertical-align: baseline; background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif; overflow-x: auto; overflow-y: auto; width: auto; max-height: 600px; line-height: 18px; text-align: left; border-width: 0px; padding: 5px;"><code style="border-style: initial; border-color: initial; vertical-align: baseline; background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: #eeeeee; font-family: Consolas, Menlo, Monaco, 'Lucida Console', 'Liberation Mono', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Courier New', monospace, serif; border-width: 0px; padding: 0px; margin: 0px;"><span class="tag" style="border-style: initial; border-color: initial; vertical-align: baseline; background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: transparent; color: #800000; border-width: 0px; padding: 0px; margin: 0px;">&lt;appSettings&gt;</span><span class="pln" style="border-style: initial; border-color: initial; vertical-align: baseline; background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: transparent; border-width: 0px; padding: 0px; margin: 0px;"><br />&nbsp; &nbsp; </span><span class="tag" style="border-style: initial; border-color: initial; vertical-align: baseline; background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: transparent; color: #800000; border-width: 0px; padding: 0px; margin: 0px;">&lt;add</span><span class="pln" style="border-style: initial; border-color: initial; vertical-align: baseline; background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: transparent; border-width: 0px; padding: 0px; margin: 0px;"> </span><span class="atn" style="border-style: initial; border-color: initial; vertical-align: baseline; background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: transparent; color: #ff0000; border-width: 0px; padding: 0px; margin: 0px;">key</span><span class="pun" style="border-style: initial; border-color: initial; vertical-align: baseline; background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: transparent; border-width: 0px; padding: 0px; margin: 0px;">=</span><span class="atv" style="border-style: initial; border-color: initial; vertical-align: baseline; background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: transparent; color: #0000ff; border-width: 0px; padding: 0px; margin: 0px;">"aspnet:MaxHttpCollectionKeys"</span><span class="pln" style="border-style: initial; border-color: initial; vertical-align: baseline; background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: transparent; border-width: 0px; padding: 0px; margin: 0px;"> </span><span class="atn" style="border-style: initial; border-color: initial; vertical-align: baseline; background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: transparent; color: #ff0000; border-width: 0px; padding: 0px; margin: 0px;">value</span><span class="pun" style="border-style: initial; border-color: initial; vertical-align: baseline; background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: transparent; border-width: 0px; padding: 0px; margin: 0px;">=</span><span class="atv" style="border-style: initial; border-color: initial; vertical-align: baseline; background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: transparent; color: #0000ff; border-width: 0px; padding: 0px; margin: 0px;">"2001"</span><span class="pln" style="border-style: initial; border-color: initial; vertical-align: baseline; background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: transparent; border-width: 0px; padding: 0px; margin: 0px;"> </span><span class="tag" style="border-style: initial; border-color: initial; vertical-align: baseline; background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: transparent; color: #800000; border-width: 0px; padding: 0px; margin: 0px;">/&gt;</span><span class="pln" style="border-style: initial; border-color: initial; vertical-align: baseline; background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: transparent; border-width: 0px; padding: 0px; margin: 0px;"><br />&nbsp;</span><span class="tag" style="border-style: initial; border-color: initial; vertical-align: baseline; background-image: initial; background-attachment: initial; background-origin: initial; background-clip: initial; background-color: transparent; color: #800000; border-width: 0px; padding: 0px; margin: 0px;">&lt;/appSettings&gt;</span></code></pre>
<p>However, this forced me to realise how poorly coded this individual page was, and that I had been using far too many HiddenFields within DataGrids, GridViews and Repeaters.</p>
<p>On this problematic page, I was using HiddenFields to hold information for each item in the repeater control, and when the repeater was being Paged this worked fine. The client had asked for a facility to "View All", which meant that there were potentially 500 + items within the repeater, and each Item had 5 HiddenFields. I had never really thought about it before, but now I realise that there would be times when the page was posting 2500+ fields to the page!!! No No No.</p>
<p>I have updated the HiddenFields to Literals now and everything is working as it should, also I have cut the ViewState down massively!</p>
<p>This is just another reason though why I am glad to be moving away from webforms and the &lt;form runat="server"&gt; wrapping pages. MVC FTW!!! :)</p>
<p><em><span style="color: orange; font-weight: bold;">PLEASE LEAVE COMMENTS!</span>&nbsp;</em><em>I am always interested in hearing back from those who read my blog. Please leave a comment if you found this useful, want to suggest any changes to my code, or anything else! Thanks!</em></p>

</div>